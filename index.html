<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>House Party Jukebox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-alt: #111827;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --accent-text: #bbf7d0;
      --text: #e5e7eb;
      --text-dim: #9ca3af;
      --danger: #f97373;
      --border: #1f2937;
      --radius-lg: 18px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.45);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      background: radial-gradient(circle at top left, #111827, #020617 55%);
      font-family: var(--font-main);
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .app-shell {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(6,17,35,0.98));
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148,163,184,0.2);
      padding: 20px 22px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .title {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .pill {
      font-size: .7rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.5);
      color: var(--text-dim);
    }
    .subtitle {
      font-size: .9rem;
      color: var(--text-dim);
    }
    .status-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: .8rem;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.9);
    }
    .status-dot {
      width: 8px; height:8px;
      border-radius: 999px;
      background: var(--danger);
    }
    .status-dot.ok { background: var(--accent); }
    .status-label {
      color: var(--text-dim);
    }
    .status-value {
      font-weight: 600;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      padding: 8px 14px;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text);
      background: rgba(15,23,42,0.95);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background .15s ease, transform .05s ease, box-shadow .15s ease;
    }
    .btn:hover {
      background: rgba(30,64,175,0.5);
      transform: translateY(-1px);
      box-shadow: 0 8px 25px rgba(15,23,42,0.8);
    }
    .btn:active { transform: translateY(0); box-shadow: none; }
    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-color: #22c55e;
      color: #022c22;
      box-shadow: 0 10px 30px rgba(22,163,74,0.5);
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, #4ade80, #22c55e);
    }
    .btn-ghost {
      background: transparent;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    @media (min-width: 900px) {
      .layout {
        flex-direction: row;
        align-items: flex-start;
      }
      .col {
        flex: 1;
      }
    }

    .panel {
      background: radial-gradient(circle at top left, rgba(30,64,175,0.15), rgba(15,23,42,0.96));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148,163,184,0.35);
      padding: 14px 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
    }
    .panel-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
    }
    .panel-title {
      font-size: 0.95rem;
      font-weight: 600;
    }
    .panel-subtitle {
      font-size: 0.8rem;
      color: var(--text-dim);
    }
    .panel-body {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .search-bar {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .input-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(31,41,55,0.9);
      background: rgba(15,23,42,0.9);
      padding: 8px 12px;
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
    }
    .input::placeholder {
      color: #6b7280;
    }
    .note-input {
      border-radius: 999px;
      border: 1px dashed rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.6);
      padding: 6px 10px;
      font-size: 0.8rem;
      color: var(--text-dim);
      outline: none;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: var(--text-dim);
    }

    .tracks-list {
      border-radius: var(--radius-md);
      border: 1px solid rgba(31,41,55,0.9);
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(6,8,16,0.98));
      padding: 4px;
      max-height: 380px;
      overflow: auto;
    }
    .track-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 6px;
      border-radius: 9px;
      cursor: pointer;
      transition: background .12s ease, transform .05s ease;
    }
    .track-row:hover {
      background: rgba(31,41,55,0.85);
      transform: translateY(-1px);
    }
    .track-meta {
      flex: 1;
      min-width: 0;
    }
    .track-title {
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-sub {
      font-size: 0.8rem;
      color: var(--text-dim);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-note {
      font-size: 0.75rem;
      color: var(--accent-text);
      margin-top: 2px;
    }
    .pill-small {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--text-dim);
    }
    .timestamp {
      font-size: 0.7rem;
      color: #64748b;
    }
    .msg {
      font-size: 0.8rem;
      color: var(--text-dim);
      padding: 4px 2px;
    }
    .msg.error {
      color: var(--danger);
    }
    .msg.success {
      color: var(--accent-text);
    }
    .chip-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="title-block">
      <div class="title">
        ðŸŽ§ House Party Jukebox
        <span class="pill">Guests can add songs â€“ host controls Sonos</span>
      </div>
      <div class="subtitle">
        Scan this page on the Surface, log in to Spotify once, and let everyone search &
        add tracks to the shared playlist.
      </div>
    </div>
    <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-end;">
      <div class="status-chip" id="authStatusChip">
        <span class="status-dot" id="authStatusDot"></span>
        <span class="status-label">Spotify</span>
        <span class="status-value" id="authStatusText">Not connected</span>
      </div>
      <div style="display:flex; gap:6px;">
        <button class="btn btn-ghost" id="logoutBtn" style="display:none;">Log out</button>
        <button class="btn btn-primary" id="loginBtn">Connect Spotify</button>
      </div>
    </div>
  </header>

  <div class="layout">
    <!-- LEFT: Search & add -->
    <div class="col">
      <section class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">Search & add tracks</div>
            <div class="panel-subtitle">
              Type a song, artist, or album. Tap a result to add it to the Party playlist.
            </div>
          </div>
          <div class="badge">
            ðŸ”Š Output:
            <span style="font-weight:600;">Use Spotify app to play playlist on Sonos</span>
          </div>
        </div>
        <div class="panel-body">
          <div class="search-bar">
            <div class="input-row">
              <input id="searchInput" class="input" type="text" placeholder="Search Spotifyâ€¦" />
              <button class="btn" id="searchBtn">Search</button>
            </div>
            <input
              id="guestNoteInput"
              class="note-input"
              type="text"
              placeholder="Optional: Your name or note (e.g., 'Dave â€“ banger for later')"
            />
          </div>
          <div class="tracks-list" id="searchResults"></div>
          <div class="msg" id="searchMessage"></div>
        </div>
      </section>
    </div>

    <!-- RIGHT: Current Party playlist -->
    <div class="col">
      <section class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">Party Queue playlist</div>
            <div class="panel-subtitle">
              Tracks currently in the shared Spotify playlist. Set this playlist playing to Sonos.
            </div>
          </div>
          <div class="chip-row">
            <button class="btn btn-ghost" id="refreshPlaylistBtn">Refresh</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="tracks-list" id="playlistView"></div>
          <div class="msg" id="playlistMessage"></div>
          <div class="msg" style="margin-top:4px;">
            ðŸ’¡ In the Spotify app, open this playlist and choose your Sonos speakers as the output
            device. New tracks added here will show up there automatically.
          </div>
        </div>
      </section>
    </div>
  </div>

  <section class="panel" style="margin-top:4px;">
    <div class="panel-header">
      <div>
        <div class="panel-title">Host setup notes</div>
        <div class="panel-subtitle">
          Visible only to you. This explains how to wire it to Sonos & Spotify.
        </div>
      </div>
    </div>
    <div class="panel-body">
      <ul class="msg" style="margin:0 0 6px 18px;">
        <li>Create a Spotify playlist called something like <b>House Party Jukebox</b>.</li>
        <li>Copy its link, extract the playlist ID, and set it in the config at the top of this file.</li>
        <li>Make sure this pageâ€™s URL is added as a redirect URI in the Spotify Developer Dashboard.</li>
        <li>From the Spotify app, play that playlist and select your Sonos group as the output device.</li>
      </ul>
      <div class="chip-row">
        <span class="badge">Guests only touch this page. You keep control of Sonos output.</span>
      </div>
    </div>
  </section>
</div>

<script>
  /**************************************************************
   * CONFIG â€“ customize these three values
   **************************************************************/
  const SPOTIFY_CLIENT_ID = "b48fe08bcf6c448aabe8774fbfdcd943";
  const REDIRECT_URI = "https://rochesterftp-sonos.github.io/sonos103/"; // must match Spotify app setting
  const PARTY_PLAYLIST_ID = "PASTE_YOUR_PLAYLIST_ID_HERE"; // e.g. 37i9dQZF1DX4dyzvuaRJ0n

  // Scopes for playlist read/write
  const SPOTIFY_SCOPES = [
    "playlist-read-private",
    "playlist-modify-private",
    "playlist-modify-public"
  ];

  /**************************************************************
   * PKCE + AUTH HANDLING
   **************************************************************/
  const authStatusDot = document.getElementById("authStatusDot");
  const authStatusText = document.getElementById("authStatusText");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  function setAuthStatus(connected, text) {
    authStatusDot.classList.toggle("ok", connected);
    authStatusText.textContent = text;
    logoutBtn.style.display = connected ? "inline-flex" : "none";
    loginBtn.style.display = connected ? "none" : "inline-flex";
  }

  function generateRandomString(length) {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";
    let result = "";
    const array = new Uint8Array(length);
    window.crypto.getRandomValues(array);
    array.forEach((v) => (result += chars[v % chars.length]));
    return result;
  }

  async function sha256(plain) {
    const encoder = new TextEncoder();
    const data = encoder.encode(plain);
    return await window.crypto.subtle.digest("SHA-256", data);
  }

  function base64UrlEncode(arrayBuffer) {
    let bytes = new Uint8Array(arrayBuffer);
    let binary = "";
    bytes.forEach((b) => (binary += String.fromCharCode(b)));
    return btoa(binary)
      .replace(/\+/g, "-")
      .replace(/\//g, "_")
      .replace(/=+$/, "");
  }

  async function createCodeChallenge(verifier) {
    const hashed = await sha256(verifier);
    return base64UrlEncode(hashed);
  }

  function getStoredTokens() {
    const raw = localStorage.getItem("sj_spotify_tokens");
    if (!raw) return null;
    try {
      return JSON.parse(raw);
    } catch {
      return null;
    }
  }

  function storeTokens(tokens) {
    localStorage.setItem("sj_spotify_tokens", JSON.stringify(tokens));
  }

  function clearTokens() {
    localStorage.removeItem("sj_spotify_tokens");
  }

  async function fetchWithAuth(url, options = {}) {
    let tokens = getStoredTokens();
    if (!tokens || !tokens.access_token) {
      throw new Error("Not authenticated with Spotify");
    }
    const headers = options.headers || {};
    headers["Authorization"] = `Bearer ${tokens.access_token}`;
    headers["Content-Type"] = headers["Content-Type"] || "application/json";
    options.headers = headers;

    let res = await fetch(url, options);
    if (res.status === 401 && tokens.refresh_token) {
      // try refresh
      const ok = await refreshAccessToken(tokens.refresh_token);
      if (!ok) throw new Error("Spotify session expired. Please reconnect.");
      tokens = getStoredTokens();
      headers["Authorization"] = `Bearer ${tokens.access_token}`;
      options.headers = headers;
      res = await fetch(url, options);
    }
    if (!res.ok) {
      const body = await res.text();
      throw new Error(`Spotify error ${res.status}: ${body}`);
    }
    return res;
  }

  async function refreshAccessToken(refreshToken) {
    const params = new URLSearchParams();
    params.append("grant_type", "refresh_token");
    params.append("refresh_token", refreshToken);
    params.append("client_id", SPOTIFY_CLIENT_ID);

    const res = await fetch("https://accounts.spotify.com/api/token", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: params,
    });
    if (!res.ok) {
      clearTokens();
      return false;
    }
    const data = await res.json();
    const existing = getStoredTokens() || {};
    const merged = {
      ...existing,
      access_token: data.access_token,
      expires_in: data.expires_in,
      token_type: data.token_type,
    };
    if (data.refresh_token) {
      merged.refresh_token = data.refresh_token;
    }
    storeTokens(merged);
    return true;
  }

  function beginSpotifyLogin() {
    const state = generateRandomString(16);
    const codeVerifier = generateRandomString(64);
    localStorage.setItem("sj_spotify_state", state);
    localStorage.setItem("sj_spotify_verifier", codeVerifier);

    createCodeChallenge(codeVerifier).then((codeChallenge) => {
      const params = new URLSearchParams();
      params.append("client_id", SPOTIFY_CLIENT_ID);
      params.append("response_type", "code");
      params.append("redirect_uri", REDIRECT_URI);
      params.append("code_challenge_method", "S256");
      params.append("code_challenge", codeChallenge);
      params.append("state", state);
      params.append("scope", SPOTIFY_SCOPES.join(" "));

      const authUrl = `https://accounts.spotify.com/authorize?${params.toString()}`;
      window.location = authUrl;
    });
  }

  async function handleAuthCallback() {
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");
    const state = params.get("state");
    const storedState = localStorage.getItem("sj_spotify_state");

    if (!code) return; // nothing to do

    // Clear query params from URL afterwards
    window.history.replaceState({}, document.title, REDIRECT_URI);

    if (!state || state !== storedState) {
      alert("Spotify login failed: state mismatch. Please try again.");
      return;
    }
    const codeVerifier = localStorage.getItem("sj_spotify_verifier");
    if (!codeVerifier) {
      alert("Missing code verifier; reload and try again.");
      return;
    }

    const body = new URLSearchParams();
    body.append("grant_type", "authorization_code");
    body.append("code", code);
    body.append("redirect_uri", REDIRECT_URI);
    body.append("client_id", SPOTIFY_CLIENT_ID);
    body.append("code_verifier", codeVerifier);

    try {
      const res = await fetch("https://accounts.spotify.com/api/token", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body,
      });
      if (!res.ok) {
        const txt = await res.text();
        console.error("Token exchange failed:", txt);
        alert("Spotify login failed. Check redirect URI and try again.");
        return;
      }
      const data = await res.json();
      storeTokens(data);
      localStorage.removeItem("sj_spotify_state");
      localStorage.removeItem("sj_spotify_verifier");
      setAuthStatus(true, "Connected");
      await refreshPlaylistView();
    } catch (err) {
      console.error(err);
      alert("Error completing Spotify login.");
    }
  }

  /**************************************************************
   * UI: Search & add tracks
   **************************************************************/
  const searchInput = document.getElementById("searchInput");
  const searchBtn = document.getElementById("searchBtn");
  const searchResults = document.getElementById("searchResults");
  const searchMessage = document.getElementById("searchMessage");
  const guestNoteInput = document.getElementById("guestNoteInput");

  async function performSearch() {
    const q = searchInput.value.trim();
    if (!q) {
      searchMessage.textContent = "Type something to search.";
      return;
    }
    searchMessage.textContent = "Searchingâ€¦";
    searchResults.innerHTML = "";

    try {
      const url = `https://api.spotify.com/v1/search?type=track&limit=15&q=${encodeURIComponent(q)}`;
      const res = await fetchWithAuth(url);
      const data = await res.json();
      const tracks = data.tracks?.items || [];
      if (!tracks.length) {
        searchMessage.textContent = "No results. Try a different search term.";
        return;
      }
      searchMessage.textContent = `Showing ${tracks.length} result(s). Tap a track to add to the Party playlist.`;
      tracks.forEach((t) => {
        const row = document.createElement("div");
        row.className = "track-row";
        row.onclick = () => addTrackToParty(t);

        const meta = document.createElement("div");
        meta.className = "track-meta";

        const title = document.createElement("div");
        title.className = "track-title";
        title.textContent = t.name;

        const sub = document.createElement("div");
        sub.className = "track-sub";
        const artistNames = t.artists.map((a) => a.name).join(", ");
        sub.textContent = `${artistNames} â€¢ ${t.album.name}`;

        meta.appendChild(title);
        meta.appendChild(sub);

        const right = document.createElement("div");
        right.style.display = "flex";
        right.style.flexDirection = "column";
        right.style.alignItems = "flex-end";
        right.style.gap = "4px";

        const pill = document.createElement("span");
        pill.className = "pill-small";
        pill.textContent = "Tap to queue";
        right.appendChild(pill);

        row.appendChild(meta);
        row.appendChild(right);
        searchResults.appendChild(row);
      });
    } catch (err) {
      console.error(err);
      searchMessage.textContent = "Error talking to Spotify. Try reconnecting.";
    }
  }

  async function addTrackToParty(track) {
    if (!PARTY_PLAYLIST_ID || PARTY_PLAYLIST_ID === "PASTE_YOUR_PLAYLIST_ID_HERE") {
      alert("You still need to set PARTY_PLAYLIST_ID in the HTML file.");
      return;
    }
    const note = guestNoteInput.value.trim();
    searchMessage.textContent = `Adding "${track.name}"â€¦`;

    try {
      // 1) Add track to playlist
      const addRes = await fetchWithAuth(
        `https://api.spotify.com/v1/playlists/${PARTY_PLAYLIST_ID}/tracks`,
        {
          method: "POST",
          body: JSON.stringify({ uris: [track.uri] }),
        }
      );
      const addData = await addRes.json();
      const snapshotId = addData.snapshot_id;

      // 2) Optionally encode note into playlist description (very simple approach: latest note)
      if (note) {
        const desc = `Party Jukebox â€“ last added by: ${note}`;
        await fetchWithAuth(`https://api.spotify.com/v1/playlists/${PARTY_PLAYLIST_ID}`, {
          method: "PUT",
          body: JSON.stringify({ description: desc }),
        });
      }

      searchMessage.textContent = `Added: ${track.name}`;
      guestNoteInput.value = "";
      // refresh playlist view
      await refreshPlaylistView();
    } catch (err) {
      console.error(err);
      searchMessage.textContent = "Failed to add track. Check connection & scopes.";
    }
  }

  /**************************************************************
   * Playlist view
   **************************************************************/
  const playlistView = document.getElementById("playlistView");
  const playlistMessage = document.getElementById("playlistMessage");
  const refreshPlaylistBtn = document.getElementById("refreshPlaylistBtn");

  async function refreshPlaylistView() {
    playlistView.innerHTML = "";
    playlistMessage.textContent = "Loading playlistâ€¦";

    if (!PARTY_PLAYLIST_ID || PARTY_PLAYLIST_ID === "PASTE_YOUR_PLAYLIST_ID_HERE") {
      playlistMessage.textContent = "Host still needs to set PARTY_PLAYLIST_ID in the HTML config.";
      return;
    }

    try {
      const res = await fetchWithAuth(
        `https://api.spotify.com/v1/playlists/${PARTY_PLAYLIST_ID}`
      );
      const data = await res.json();

      const name = data.name || "Party playlist";
      const desc = data.description || "";
      const tracks = data.tracks?.items || [];

      playlistMessage.textContent = `${name} â€“ ${tracks.length} track(s)`;
      if (desc) {
        const noteDiv = document.createElement("div");
        noteDiv.className = "msg";
        noteDiv.textContent = `Playlist note: ${desc}`;
        playlistView.appendChild(noteDiv);
      }

      tracks.forEach((item, index) => {
        const t = item.track;
        if (!t) return;
        const row = document.createElement("div");
        row.className = "track-row";

        const meta = document.createElement("div");
        meta.className = "track-meta";

        const title = document.createElement("div");
        title.className = "track-title";
        title.textContent = `${index + 1}. ${t.name}`;

        const sub = document.createElement("div");
        sub.className = "track-sub";
        const artistNames = t.artists.map((a) => a.name).join(", ");
        const addedBy =
          item.added_by && item.added_by.id ? ` â€¢ added by ${item.added_by.id}` : "";
        sub.textContent = `${artistNames} â€¢ ${t.album.name}${addedBy}`;

        meta.appendChild(title);
        meta.appendChild(sub);

        row.appendChild(meta);
        playlistView.appendChild(row);
      });

      if (!tracks.length) {
        const empty = document.createElement("div");
        empty.className = "msg";
        empty.textContent = "Playlist is currently empty. Add something from the left.";
        playlistView.appendChild(empty);
      }
    } catch (err) {
      console.error(err);
      playlistMessage.textContent = "Error loading playlist from Spotify.";
    }
  }

  /**************************************************************
   * Wire up events & bootstrap auth state
   **************************************************************/
  loginBtn.addEventListener("click", () => {
    beginSpotifyLogin();
  });

  logoutBtn.addEventListener("click", () => {
    clearTokens();
    setAuthStatus(false, "Not connected");
    searchResults.innerHTML = "";
    playlistView.innerHTML = "";
    searchMessage.textContent = "";
    playlistMessage.textContent = "Logged out of Spotify.";
  });

  searchBtn.addEventListener("click", () => {
    performSearch();
  });
  searchInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") performSearch();
  });

  refreshPlaylistBtn.addEventListener("click", () => {
    refreshPlaylistView();
  });

  (async function init() {
    const tokens = getStoredTokens();
    if (tokens && tokens.access_token) {
      setAuthStatus(true, "Connected");
      try {
        await refreshPlaylistView();
      } catch {
        // ignore; user might need to re-auth
      }
    } else {
      setAuthStatus(false, "Not connected");
    }

    // handle Spotify redirect, if present
    await handleAuthCallback();
  })();
</script>
</body>
</html>
